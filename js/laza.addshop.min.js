!function(e){"use strict";e.fn.addShop=function(t,n){if(n=e.extend({},e.fn.addShop.defaults,n),!t||!t.length||!n.id)return this;var o,i,a,r,s,p="undefined",d=e.fn.addShop.id,l=e.fn.addShop.text,c=n.id.replace("|","@"),u=DEBUG?e.fn.addShop.st.sandboxurl:e.fn.addShop.st.url,h=e.fn.addShop.st.curr_symbol[n.currency]||n.currency,m=(e.fn.addShop.st.btn_lng[n.locale],e(this).eq(0)),g=t.length,f=g>1?e.fn.addShop.st.targetCart:e.fn.addShop.st.target,b=function(t,n,o,i,a){if(!t||!n)return{};var r=e("<input>",{type:i||"text"}).appendTo(t);return r.prop("name",n),o&&r.val("string"==typeof o?o.stripQuote():o),a&&r.prop(a,!0),r},y=function(e){if(typeof e===p)return _(g>1?d.discountRateCart:d.discountRate);g>1?_(d.discountRateCart,e):(_(d.discountRate,e),_(d.discountRate+"2",e))},v=function(e){if(typeof e===p)return _(g>1?d.discountAmountCart:d.discountAmount);_(g>1?d.discountAmountCart:d.discountAmount,e)},w=function(e,t){var n=i.children("[name="+d.option+"]");if(n&&n.length){var o=n.val().replace(/(\s\(CC\:.+\))$/,"");n.val(o+" (CC:"+e+(typeof t!==p?"="+t:"")+")")}},_=function(e,t){var n=i.children("[name="+e+"]");if(typeof t===p)return n&&n.length?parseFloat(n.val()):null;null==t?n.remove():n&&n.length?n.val(t):b(i,e,t,"hidden")},C=function(){var e=o.children("select").eq(0);return e&&e.length?e.prop("selectedIndex"):0},x=function(){var t=C(),n=o.children(".discount").eq(0),i=o.children(".total").eq(0),a=o.children("[name=copies]").val()||1,r=s[t].price,p=s[t].shipping+(a-1)*s[t].shipping2,d=v(),l=y();n.length||(n=e("<span>",{'class':"discount"}).insertAfter(o.children("select"))),d&&d>0?(n.show().html("- "+h+" "+d.toFixed(2)),i.html(h+" <b>"+(g*(a*r+p)-d).toFixed(2)+"</b>")):l&&l>0?(n.show().text("-"+l+"%"),i.html(h+" <b>"+(g*(a*r*(100-l)/100+p)).toFixed(2)+"</b>")):(n.hide(),i.html(h+" <b>"+(g*(a*r+p)).toFixed(2)+"</b>"))},S=function(){var e=C(),t=o.children("[name=copies]").val()||1,i=s[e].price,a=s[e].shipping,r=s[e].shipping2;if(n.quantityCap&&t>n.quantityCap&&o.children("[name=copies]").val(t=n.quantityCap),g>1)for(var p=1;p<=g;p++)_(d.price+"_"+p,i),_(d.copies+"_"+p,t),_(d.shipping+"_"+p,a||null),_(d.shipping2+"_"+p,r||null);else _(d.price,i),_(d.copies,t),_(d.shipping,a||null),_(d.shipping2,r||null);_(d.option,s[e].text),x()},T=function(t){var i,a,p=new Date,d=!0===t;if(n.coupons&&(i=o.children("[name=coupon]"))&&(a=i.val().trim()).length){var c,u,m,f=xDecrypt(n.coupons).split("::");for(c=0;c<f.length;c++)if((u=f[c].split(/=|\s*<\s*/))[0]===a&&u.length>1){if((m=parseFloat(u[1]))<.01)continue;if(u.length>2){var b=u[2].split(/-|:|\//);if(b.length<2&&(b[1]=1),b.length<3&&(b[2]=1),new Date(parseInt(b[0]),parseInt(b[1]),parseInt(b[2]))<p)return e("body").addModal(e("<div>",{html:l.expired.replace("{0}",a)}),{type:"error"}),!1}if("%"===u[1].charAt(u[1].length-1)){if(m>99||m<1)continue;(_=y())>m?d&&e("body").addModal(e("<div>",{html:l.lowerThanCurrent.replace("{0}",_+"%")}),{type:"warning"}):(d&&e("body").addModal(e("<div>",{html:l.accepted.replace("{0}",m+"%")}),{title:l.success}),y(m),w(a,m+"%"),e.cookie("discountRate",a,86400))}else if(e.cookie("discount_"+a))d&&e("body").addModal(e("<div>",{html:l.reclaimed}),{type:"warning"}),v(null),r&&(y(r),w(a,r+"%"));else{var _=y(),S=s[C()].price,T=v()||(_>0?g*S*_/100:0);S*g<m?d&&e("body").addModal(e("<div>",{html:l.higherThanPrice.replace("{0}",h+"&nbsp;"+m)}),{type:"warning"}):T>m?d&&e("body").addModal(e("<div>",{html:l.lowerThanCurrent.replace("{0}",h+"&nbsp;"+T.toFixed(2))}),{type:"warning"}):(d?e("body").addModal(e("<div>",{html:l.accepted.replace("{0}",h+"&nbsp;"+m)}),{title:l.success}):(e.cookie("discount_"+a,m,86400),r=y(),y(null)),v(m),w(a,n.currency+" "+m))}return x(),!0}return e("body").addModal(e("<div>",{html:l.noSuch}),{type:"error"}),!1}return!0},R=function(t){var o;if("title"===n.itemNameUses){if(((o=t.data("tooltip"))&&(o=e(o)).length||(o=t.siblings(".caption")).length||(o=e(".slide .caption")).length)&&(o=o.find("h6,strong")).length&&(o=o.eq(0).text()))return o.substring(0,128)}else if("comment"===n.itemNameUses&&((o=t.data("tooltip"))&&(o=e(o)).length||(o=t.siblings(".caption")).length||(o=e(".slide .caption")).length)&&(o=o.find(".comment,small")).length&&(o=o.eq(0).text()))return o.substring(0,128);return(t=t.find("img").eq(0)).length&&(o=t.data("src")||t.attr("src")),o.length||(o="untitled"),decodeURIComponent(o.getFile()+" ["+n.path+o.getDir().replace("thumbs/","")+"]")};if((s=function(e){var t,n,o,i,a=e.split("::"),r=[];for(t=0;t<a.length;t++)if((n=a[t].split("=")).length>1){if(i={},i.label=n[0],o=n[1].split("+"),null==(i.price=parseFloat(o[0])))continue;o.length>1?i.shipping=parseFloat(o[1]):i.shipping=0,o.length>2?i.shipping2=parseFloat(o[2]):i.shipping2=i.shipping,i.text=n[0]+" = "+h+" "+i.price.toFixed(2)+(o.length>1?"+"+i.shipping.toFixed(2):""),r.push(i)}return r}(n.options)).length){if(o=e("<form>",{name:"shopping",method:"post"}).appendTo(m),g>1&&o.append(e("<span>",{'class':"count",html:"<b>"+g+"</b> &times;"})),function(t,n){var o,i=e("<select>").appendTo(t);for(o=0;o<n.length;o++)i.append(e("<option>",{val:n[o].price,html:n[o].text}));return i}(o,s).on("change",S),n.hasOwnProperty("discount")||(n.discount=e.fn.addShop.defaults.discount||0),"-"===n.discount&&(n.discount=0),1!==n.quantityCap&&(o.append("&times;"),b(o,"copies",1).addClass("copies").on("change",S)),o.append("="),o.append(e("<span>",{'class':"total"})),n.coupons){o.append(e("<input>",{type:"text",name:"coupon",'class':"coupon",placeholder:l.couponCode}));var U=e("<a>",{html:"&nbsp;",'class':"redeem"}).on("click",function(e){return e.preventDefault(),T(!0),!1});U.addTooltip(l.redeem),o.append(U)}if(i=e("<form>",{name:d.form,target:f,action:u+"cgi-bin/webscr/",method:"post"}).appendTo(m),_("cmd","_cart"),_("charset","utf-8"),_("lc",n.locale),_(d.seller,c),_(d.currency,n.currency),_(d.shopUrl,n.continueUrl||decodeURIComponent(window.location.href)),null!=n.handling&&e.isNumeric(n.handling)&&_(d.handlingCart,n.handling),_(d.option,s[0].label),n.discount&&n.discount<100&&y(n.discount),g>1?(_("upload",1),_(d.name,g+" "+l.items),t.each(function(t){_(d.name+"_"+(t+1),R(e(this)))})):(_("add",1),_(d.name,R(t.eq(0)))),S(),i.append(e("<button>",{id:"shopAdd",name:"submit",'class':"paypalbtn",html:g>1?l.buyNow:l.addCart})),i.on("submit",function(t){var o=!0,i=e(t.target);return n.coupons&&(o=T()),o?(i.parents("[data-role=dialog]").trigger("destroy"),n.continueUrl||window.open("",f,"width=1024,height=600,scrollbars=yes,resizable=yes,menubar=no,toolbar=no,directories=no,status=no,copyhistory=no"),!0):o}),n.coupons){var F=e.cookie("discountRate");F&&(e("input[name=coupon]").val(F),T(!1))}return 1===g&&(a=e("<form>",{'class':"view",name:"paypalview",target:f,action:u+"cgi-bin/webscr/",method:"post"}).appendTo(m),b(a,"cmd","_cart","hidden"),b(a,"lc",n.locale,"hidden"),b(a,d.seller,c,"hidden"),b(a,"display",1,"hidden"),a.append(e("<button>",{id:"shopView",'class':"paypalbtn",name:"submit",html:l.viewCart})),n.continueUrl||a.on("submit",function(){return window.open("",f,"width=1024,height=600,scrollbars=yes,resizable=yes,menubar=no,toolbar=no,directories=no,status=no,copyhistory=no"),!0})),x(),this}},e.fn.addShop.defaults={currency:"EUR",locale:"US",quantityCap:0,shippingFlat:!1,itemNameUses:"fileName"},e.fn.addShop.text=getTranslations({addCart:"Add to Cart",viewCart:"View Cart",buyNow:"Buy Now",items:"items",success:"Success",couponCode:"Coupon code",redeem:"Redeem",noSuch:"No such coupon exists!",expired:"The coupon code <b>{0}</b> has expired!",accepted:"The coupon code is accepted. You will get <b>{0}</b> discount the next time you add this item to the cart.",lowerThanCurrent:"This coupon offers lower discount than the current <b>{0}</b>.",higherThanPrice:"You can use this coupon only for items priced higher than <b>{0}</b>.",reclaimed:"This coupon has already been used!"}),e.fn.addShop.st={target:"ShoppingCart",targetCart:"BuyNow",url:"https://www.paypal.com/",sandboxurl:"https://www.sandbox.paypal.com/",btn_lng:{DE:"de_DE",FR:"fr_FR",IT:"it_IT",ES:"es_ES",PT:"pt_PT",DA:"da_DK",NL:"nl_NL",NO:"no_NO",SV:"sv_SE",TR:"tr_TR",RU:"ru_RU",PL:"pl_PL",IL:"he_IL",TH:"th_TH"},curr_symbol:{USD:"US$",EUR:"&euro;",GBP:"GB&pound;",JPY:"&yen;",HUF:"Ft"}},e.fn.addShop.id={form:"paypal",seller:"business",currency:"currency_code",name:"item_name",option:"item_number",custom:"custom",price:"amount",priceCart:"amount_1",copies:"quantity",discountRate:"discount_rate",discountRateCart:"discount_rate_cart",discountAmount:"discount_amount",discountAmountCart:"discount_amount_cart",shipping:"shipping",shipping2:"shipping2",handlingCart:"handling_cart",shopUrl:"shopping_url"}}(jQuery);