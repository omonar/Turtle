!function(t,e,o){"use strict";t.fn.addModal=function(n,a,i){if("string"==typeof n&&(n=t(n)),n instanceof t&&n.length){t.isArray(a)||(i=a,a=null),(i=t.extend({},t.fn.addModal.defaults,i)).savePosition=i.savePosition&&"uid"in i;var s,d,r,u,l,p,c,h,f,m=t(this),v=getTranslations(t.fn.addModal.text),g="_lmo_"+Math.floor(1e4*Math.random()),w={w:"_m_window",p:"_m_panel",h:"_m_head",c:"_m_cont",ci:"_m_cont_i",x:"close",r:"resize"},y=0,M=function(t){return t.touches&&1===t.touches.length?{x:Math.round(t.touches[0].clientX),y:Math.round(t.touches[0].clientY)}:null!==t.clientX?{x:Math.round(t.clientX),y:Math.round(t.clientY)}:null},T=function(){c=m.width(),h=m.height()},b=function(t){if("A"===t.target.nodeName||"mousedown"===t.type&&1!==t.which||d.is(":hidden"))return!0;t.preventDefault();var o=d.position().left,n=d.position().top,a=M(t.originalEvent),s=c-d.width()-i.pad,l=h-d.height()-i.pad,p=r.css("cursor");u.trigger("removeTooltip"),r.css({cursor:"move"});var f=function(t){t.preventDefault();var e=M(t.originalEvent);return d.css({left:Math.minMax(i.pad,o+e.x-a.x,s),top:Math.minMax(i.pad,n+e.y-a.y,l)}),!1},m=function(t){return t.preventDefault(),"mouseup"===t.type?e.off("mousemove."+g).off("mouseup."+g):r.off(TOUCH.MOVE+"."+g).off(TOUCH.END+"."+g),r.css("cursor",p),i.savePosition&&O(),!1};return"mousedown"===t.type?e.on("mousemove."+g,f).on("mouseup."+g,m):r.on(TOUCH.MOVE+"."+g,f).on(TOUCH.END+"."+g,m),!1},x=function(t){return t&&t.preventDefault(),u.trigger("removeTooltip"),f=clearTimeout(f),s.animate({opacity:0},i.speed,function(){s.remove()}),!1},k=function(){var t=d.width(),e=d.height();y=e-p.height(),t&&e&&c&&h&&(t+2*i.pad>c&&d.css({width:t=c-2*i.pad}),e+2*i.pad>h&&(d.css({height:e=h-2*i.pad}),p.css({height:h-2*i.pad-y})),d.css({left:Math.max(Math.round((c-t)*i.pos[0]/2),i.pad),top:Math.max(Math.round((h-e)*i.pos[1]/2),i.pad)}))},C=function(t){var e,o=Math.minMax(i.pad,parseInt(t[0],10),c-i.pad-60),n=Math.minMax(i.pad,parseInt(t[1],10),h-i.pad-60),a=Math.minMax(120,parseInt(t[2],10),c-o-i.pad);(isNaN(o)||isNaN(n)||isNaN(a))&&k(),y=r.outerHeight()+parseInt(l.css("padding-top"),10)+parseInt(l.css("padding-bottom"),10)+parseInt(p.css("padding-top"),10)+parseInt(p.css("padding-bottom"),10)+parseInt(l.css("border-top-width"),10),d.css({position:"absolute",left:o,top:n,width:a}),d.height()>(e=h-n-i.pad)&&(d.css({height:e}),p.css({height:e-y}))},O=function(){d.is(":visible")&&t.cookie("modalPosition"+i.uid,d.position().left+","+d.position().top+","+d.width()+","+d.height())};if(i.uid&&t("#"+i.uid).parents("."+w.w).remove(),i.defaultButton&&(i.defaultButton=translate(i.defaultButton,"OK")),function(){s=t("<div>",{'class':w.w,role:"dialog","data-role":"dialog","aria-hidden":!0,"aria-labelledby":w.h}).css({opacity:0}).appendTo(m),m.css({position:"relative"}),T(),i.darkenBackground&&s.addClass("darken"),d=t("<div>",{id:i.uid||g,'class':w.p+" "+i.type}).css({width:i.width}).appendTo(s),(r=t("<header>",{'class':w.h}).appendTo(d)).append(t("<h5>",{id:w.h,text:i.title||("error"===i.type||"warning"===i.type?v[i.type]:"")})),"error"!==i.type&&"warning"!==i.type||r.append(t("<span>",{'class':i.type,text:"!"})),(u=t("<a>",{'class':w.x,html:"&times;"}).appendTo(r)).addTooltip(v.closeWindow),u.on("click."+g,x),i.blocking&&i.closeOnClickOut&&s.one("click."+g,function(e){if(t(e.target).hasClass(w.w))return x(e)}),i.movable&&r.on(TOUCH.START+"."+g+" mousedown."+g,b)}(),function(e){l=t("<div>",{'class':w.c}).appendTo(d),p=t("<div>",{'class':w.ci}).append(e).appendTo(l)}(n),function(){var o=function(e){h.each(function(o){t(this).toggleClass("active",o===e)})},n=function(){e.off("keydown."+g),x()},r=function(e){if(document.activeElement&&"input"===document.activeElement.nodeName||t.isFunction(i.enableKeyboard)&&!i.enableKeyboard())return!0;var a=e?e.keyCode:window.event.keyCode;if(27===a)return n(),!1;if(f){var d=f.find("a.active"),r=h.index(d);switch(a){case 13:case 10:t.isFunction(d[0].handler)&&!1!==d[0].handler.call(s)&&n();break;case 39:o((r+1)%h.length);break;case 37:o(r?r-1:h.length-1);break;default:return!0}return!1}return!0},u=function(e){e.preventDefault();var o=e.target;return t.isFunction(o.handler)&&!1!==o.handler.call(s,d)&&n(),!1};if(a){var l,c,h,f=t("<div>",{'class':"buttons"}).appendTo(p);for(l=0;l<a.length;l++)l&&f.append(" "),c=t("<a>",{html:a[l].t}).on("click."+g,u).appendTo(f),t.isFunction(a[l].h)&&(c[0].handler=a[l].h);(h=f.children("a")).last().addClass("active"),(t.isFunction(i.enableKeyboard)||i.enableKeyboard)&&e.on("keydown."+g,r)}else i.defaultButton&&(a=[{t:i.defaultButton,h:x}])}(),function(e){s.css({opacity:0}).show(),setTimeout(function(){if(i.savePosition){var e=t.cookie("modalPosition"+i.uid);e&&(e=e.split(","))&&t.isArray(e)&&e.length>3?C(e):k(),setTimeout(function(){O()},i.speed)}else k();i.blocking||s.css({width:0,height:0,right:"auto",bottom:"auto",overflow:"visible"}),s.animate({opacity:1},i.speed).attr({tabindex:0,"aria-hidden":!1}).focus(),i.autoFade&&(f=setTimeout(x,i.autoFade)),i.scrollIntoView&&setTimeout(function(){var t=p.children(":not(.buttons)").find(".active:first");t&&t.length&&p.scrollTop(Math.max(Math.floor(t.position().top)-50,0))},200)},40)}(),o.on("resize."+g,T),s.on("destroy."+g,x),i.resizable){var E=t("<a>",{'class':w.r}).appendTo(d),D=function(t){t.preventDefault();var e=[d.position().left,d.position().top,d.width(),d.height()],o=[i.pad,i.pad,c-2*i.pad,h-2*i.pad],n=function(t){d.css({left:Math.minMax(i.gap,t[0],c-t[2]-i.gap),top:Math.minMax(i.gap,t[1],h-t[3]-i.gap),width:t[2],height:t[3]}),p.css({height:t[3]-y})};return e[0]===o[0]&&e[1]===o[1]&&e[2]===o[2]&&e[3]===o[3]?n(d.data("wpos")):(n(o),d.data("wpos",e)),i.savePosition&&O(),!1},_=function(t){if("mousedown"===t.type&&1!==t.which||d.is(":hidden"))return!0;t.preventDefault();var o=d.width(),n=d.height(),a=M(t.originalEvent),r=s.width(),l=h-i.pad-d.position().top-y,r=c-i.pad-d.position().left,f=function(t){t.preventDefault();var e=M(t.originalEvent),i=Math.min(Math.max(n+e.y-a.y-y,20),l);return d.css({width:Math.min(Math.max(o+e.x-a.x,60),r),height:i+y}),p.css({height:i}),!1},m=function(t){return t.preventDefault(),"mouseup"===t.type?e.off("mousemove."+g).off("mouseup."+g):E.off(TOUCH.MOVE+"."+g).off(TOUCH.END+"."+g),i.savePosition&&O(),!1};return u.trigger("removeTooltip"),"mousedown"===t.type?e.on("mousemove."+g,f).on("mouseup."+g,m):E.on(TOUCH.MOVE+"."+g,f).on(TOUCH.END+"."+g,m),!1};r.on("dblclick."+g,D),E.on(TOUCH.START+"."+g+" mousedown."+g,_)}return this}},t.fn.addModal.defaults={speed:300,autoFade:0,width:400,resizable:!1,movable:!0,blocking:!0,enableKeyboard:!0,closeOnClickOut:!0,darkenBackground:!0,savePosition:!1,scrollIntoView:!1,defaultButton:"okButton",pad:6,pos:[1,1],type:"normal"},t.fn.addModal.text={closeWindow:"Close window",error:"error",warning:"warning"}}(jQuery,$(document),$(window));